<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Currents</title>

  <!-- Bootstrap -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>

<!-- Font Awesome -->
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>
</head>

<body class="bg-light text-dark py-5">
  <div class="container">
    <h2 class="mb-4 text-center">Available Currents</h2>

    <div id="file-list" class="list-group shadow-sm"></div>
    <div id="status" class="mt-3 text-success text-center"></div>
  </div>

  <script>
    fetch('files.json')
      .then(r => r.json())
      .then(files => {
        const list = document.getElementById("file-list");
        files.forEach(filename => {
          const displayName = filename.replace(/\.zip$/i, "");
          const item = document.createElement("div");
          item.className = "list-group-item d-flex justify-content-between align-items-center";
    
          const name = document.createElement("span");
          name.textContent = displayName;
    
          const button = document.createElement("button");
          button.className = "btn btn-outline-secondary btn-sm";
          button.innerHTML = '<i class="fa-solid fa-clipboard"></i>';
          button.onclick = () => copyLink(filename, button);
    
          item.appendChild(name);
          item.appendChild(button);
          list.appendChild(item);
        });
    });

    function copyLink(filename, button) {
      const subdirectory = "files";
      let base = `${window.location.origin}${window.location.pathname.replace(/\/index\.html$/, '')}`;
      base = base.replace(/\/+$/, '');
      const encodedName = encodeURIComponent(filename);
      const url = `${base}/${subdirectory}/${encodedName}`;
      
      navigator.clipboard.writeText(url).then(() => {
        const status = document.getElementById("status");
        status.textContent = `Copied: ${url}`;
        button.innerHTML = '<i class="fa-solid fa-check text-success"></i>';
        setTimeout(() => {
          status.textContent = "";
          button.innerHTML = '<i class="fa-solid fa-clipboard"></i>';
        }, 2500);
      });
    }
  </script>
</body>
</html>
